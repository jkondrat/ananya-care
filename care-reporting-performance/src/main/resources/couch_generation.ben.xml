<?xml version="1.0" encoding="iso-8859-1"?>
<setup>
    <import platforms='couchdb'/>
    <couchdb database='persondb' name='motech_motech-person-repository' environment='perfcouchdb'/>
    <couchdb database='providerdb' name='motech_motech-provider-repository'  environment='perfcouchdb'/>
    <couchdb database='patientdb' name='motech_motech-patient-repository' environment='perfcouchdb'/>
    <couchdb database='observationdb' name='motech_motech-observation-repository'  environment='perfcouchdb'/>
    <couchdb database='encounterdb' name='motech_motech-encounter-repository'  environment='perfcouchdb'/>

    <setting name="patient_count" default="1"/>
    <setting name="provider_count" default="1"/>
    <setting name="observation_count" default="20"/>
    <setting name="encounter_count" default="1"/>
    <setting name="observation_per_encounter_count" default="1"/>
    <setting name="attributes_per_patient_count" default="3"/>
    <setting name="string_length" default="10"/>

    <memstore id="providerStore"/>
    <memstore id="patientStore"/>
    <memstore id="observationStore"/>

    <echo>Populate Provider Entity Store</echo>
    <generate type="providerEntityStore" count="{provider_count}" consumer="providerStore">
        <id name="id" type="string" generator="UUIDGenerator"/>
        <attribute name="personId"  type="string" generator="UUIDGenerator"/>
    </generate>

    <echo>Populate Patient Entity Store</echo>
    <generate type="patientEntityStore" count="{patient_count}" consumer="patientStore">
        <id name="id" type="string" generator="UUIDGenerator"/>
        <attribute name="personId" type="string" generator="UUIDGenerator"/>
    </generate>

    <echo>Generate Provider Person Entities</echo>
    <generate type='Person' count='{provider_count}' consumer='persondb'>
        <variable name="providerDetail" source="providerStore" type="providerEntityStore" />
        <attribute name="age" type="int" generator="new RandomIntegerGenerator(0,100)"/>
        <attribute name="birthDateEstimated" type="boolean"/>
        <attribute name="dateOfBirth" type="date" generator="DayGenerator"/>
        <attribute name="dead" type="boolean"/>
        <attribute name="firstName" type="string" maxLength="{string_length}"/>
        <attribute name="gender" type="string"  values="'male','female'"/>
        <attribute name="personId"  script="providerDetail.personId"/>
        <part name="attributes" container="list" count="{attributes_per_patient_count}">
            <attribute name="name" type="string" maxLength="{string_length}"/>
            <attribute name="value" type="string" maxLength="{string_length}"/>
        </part>
    </generate>

    <echo>Generate Patient Person Entities</echo>
    <generate type='Person' count='{patient_count}' consumer='persondb'>
        <variable name="patientDetail" source="patientStore" type="patientEntityStore" />
        <attribute name="age" type="int" generator="new RandomIntegerGenerator(0,100)"/>
        <attribute name="birthDateEstimated" type="boolean"/>
        <attribute name="dateOfBirth" type="date" generator="DayGenerator"/>
        <attribute name="dead" type="boolean"/>
        <attribute name="firstName" type="string" maxLength="{string_length}"/>
        <attribute name="gender" type="string"  values="'male','female'"/>
        <attribute name="personId"  script="patientDetail.personId"/>
        <part name="attributes" container="list" count="{attributes_per_patient_count}">
            <attribute name="name" type="string" maxLength="{string_length}"/>
            <attribute name="value" type="string" maxLength="{string_length}"/>
        </part>
    </generate>

    <echo>Generate Provider Entities</echo>
    <generate type='Provider' count='{provider_count}' consumer='providerdb'>
        <variable name="providerDetail" source="providerStore" type="providerEntityStore" distribution="random" cyclic="true"/>
        <attribute name="personId"  script="providerDetail.personId"/>
        <attribute name="providerId" script="providerDetail.id"/>
    </generate>

    <echo>Generate Patient Entities</echo>
    <generate type='Patient' count='{patient_count}' consumer='patientdb'>
        <variable name="patientDetail" source="patientStore" type="patientEntityStore" distribution="random" cyclic="true"/>
        <attribute name="personId"  script="patientDetail.personId"/>
        <attribute name="patientId" script="patientDetail.id"/>
        <attribute name="motechId" type="string" generator="UUIDGenerator"/>
    </generate>

    <echo>Generate Observation Entities</echo>
    <generate type='Observation' count='{observation_count}' consumer='observationdb'>
        <variable name="patientEntity" source="patientStore" type="patientEntityStore" cyclic="true" />

        <attribute name="patientId" script="patientEntity.id"/>
        <attribute name="observationId" type="string" generator="UUIDGenerator"/>
        <attribute name="date" type="date" generator="CurrentDateTimeGenerator"/>
        <attribute name="conceptName"  type="string" maxLength="{string_length}"/>
        <attribute name="value" type="string" maxLength="{string_length}"/>
    </generate>

    <echo>Generate Encounter Entities</echo>
    <generate type='Encounter' count='{encounter_count}' consumer='encounterdb'>
        <variable name="providerDetail" source="providerStore" type="providerEntityStore" distribution="random" cyclic="true"/>
        <variable name="patientDetail" source="patientStore" type="patientEntityStore" distribution="random" cyclic="true"/>

        <attribute name="encounterId" type="string" generator="UUIDGenerator"/>
        <attribute name="providerId" script="providerDetail.id"/>
        <attribute name="patientId" script="patientDetail.id"/>
        <attribute name="date" type="date" generator="CurrentDateTimeGenerator"/>
        <attribute name="encounterType" type="string" values="'MTP ABORT [Mother]','BP [Mother]','CP [Mother]','Close [Mother]','Death Registration [Mother]','Delivery Update [Mother]','EBF [Mother]','Migrate In [Mother]','Migrate Out [Mother]','New [Mother]','PNC [Mother]','Referral [Mother]','Registration [Mother]','Update Vaccinations [Mother]'"/>
        <part name="observationIds" container="array" count="{observation_per_encounter_count}">
            <id type="string" script="Observation.observationId" />
        </part>
    </generate>
</setup>