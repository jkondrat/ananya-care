<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">
    
    <changeSet id="CARE #92" author="Łukasz Gąsior">
        <sql>
            delete from dashboard_app.role_permission where role_id in (2, 3) and permission_id = 4;
        </sql>
    </changeSet>

    <changeSet id="CARE #25" author="Lech Różański">
        <sql>
            alter table dashboard_app.dw_query
                add column parent_id integer,
                add column name character varying(100),
                add constraint dw_query_parent_id foreign key (parent_id)
                    references dashboard_app.dw_query (dw_query_id) match full
                    on update cascade on delete cascade not deferrable,
                add constraint dw_query_uk unique (name);

            drop table dashboard_app.dw_query_select_column;

            alter table dashboard_app.select_column
                add column dw_query_id integer not null,
                add constraint select_column_dw_query_id foreign key (dw_query_id)
                    references dashboard_app.dw_query (dw_query_id) match full
                    on update cascade on delete cascade not deferrable;
        </sql>
    </changeSet>

</databaseChangeLog>
