<div ng:init="$root.pageTitle = title"></div>

<h1 class="text-center">{{msg('indicators.form.header')}}</h1>
<div class="container-fluid">
    <form id="indicatorForm" name="form" novalidate>
        <div class="row-fluid">
            <div class="span4 well">
                <div class="nested-well">
                    <legend>{{msg('indicators.form.defineIndicatorDescription')}}:</legend>
                    <label for="name">{{msg('indicators.form.name.label')}}: </label>
                    <input id="name" type="text" ng-model="indicator.name" class="input-block-level" placeholder="{{msg('indicators.form.name.placeholder')}}" required />
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th colspan="2">{{msg('indicators.form.categories.label')}}:</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="item in indicator.categories">
                            <td class="span9">
                                <span>{{item.name}}</span>
                            </td>
                            <td class="span3">
                                <button class="span12 btn" ng-click="removeCategory($index)">{{msg('common.remove')}}</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <label for="category">{{msg('indicators.form.classifiedAs')}}: </label>
                    <select id="category" ng-model="selectedCategory" ng-options="item as item.name for item in listCategories" class="input-block-level"></select>
                    <div class="text-right">
                        <button class="btn" ng-click="addCategory()" ng-disabled="listCategories.length <= 0">{{msg('indicators.form.addCategory')}}</button>
                    </div>
                </div>
                <div class="nested-well">
                    <fieldset>
                        <legend>{{msg('indicators.form.defineReportView')}}:</legend>
                        <div class="scroll">
                            <ul class="unstyled">
                                <li ng-repeat="item in formData.roles">
                                    <input id="indicatorOwner_{{item.id}}" type="checkbox" ng-model="selectedOwners[item.id]" value="{{item.id}}" ng-click="validateOwners()" />
                                    <label class="inline" for="indicatorOwner_{{item.id}}">{{item.name}}</label>
                                </li>
                            </ul>
                        </div>
                    </fieldset>
                </div>
                <div class="nested-well">
                    <fieldset>
                        <legend>{{msg('indicators.form.chooseChartType')}}:</legend>
                        <div id="chooseChartType">
                            <select ng-model="selectedChartType" ng-options="item.id as item.name for item in formData.reportTypes" class="input-block-level" required></select>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="span4 well">
                <div class="nested-well">
                    <legend>{{msg('indicators.form.defineDataForIndicator')}}:</legend>
                    <label for="form">{{msg('indicators.form.selectForm')}}: </label>
                    <select id="form" ng-model="selectedForm" ng-options="item.id as item.displayName for item in formData.forms" class="input-block-level" required></select>
                    <label for="computedField">{{msg('indicators.form.label.aggregatedField')}}:</label>
                    <select id="computedField" ng-model="indicator.computedField" ng-options="item.id as item.name for item in formData.computedFields" class="input-block-level" required></select>
                    <label for="complexCondition">{{msg('indicators.form.label.complexCondition')}}:</label>
                    <select id="complexCondition" ng-model="indicator.complexCondition" ng-options="item.id as item.name for item in formData.complexConditions" class="input-block-level" required></select>
                </div>
                <div class="nested-well">
                    <fieldset>
                        <legend>{{msg('indicators.form.trend')}} <small>({{msg('common.optional')}})</small>:</legend>
                        <label for="trend">{{msg('indicators.form.trend.label')}}: </label>
                        <input id="trend" type="number" ng-model="indicator.trend" class="input-block-level" placeholder="{{msg('indicators.form.trend.placeholder')}}" />
                    </fieldset>
                </div>
                <div class="row-fluid" id="formButtons">
                    <div class="btn-group">
                        <button class="btn btn-primary " ng-click="submit()" ng-disabled="form.$invalid || !ownersValid || !categoriesValid || !typeValid || reportTypes.length <= 0">{{msg('common.save')}}</button>
                    </div>
                </div>
            </div>
            <div class="span4" ng-controller="indicatorListController">
                <div class="span12 well">
                    <div class="nested-well">
                        <legend>{{msg('indicators.form.createNewFeature')}}:</legend>
                        <div class="row-fluid" id="formButtonsNew">
                            <button class="btn btn-block" ng-click="addNewIndicator()">{{msg('indicators.list.addNew')}}</button>
                            <button class="btn btn-block" ng-click="launchDialog()" ng-disabled="listForms.length <= 0">{{msg('indicators.form.createNewComplexCondition')}}</button>
                        </div>
                    </div>
                    <div class="nested-well">
                        <legend>{{msg('indicators.form.indicatorsList')}}:</legend>
                        <div>
                            <label for="categoryName">{{msg('indicators.list.chooseCategory')}}</label>
                            <select id="categoryName" class="input-block-level" ng-model="selectedCategory" ng-options="cat.id as cat.name for cat in category">
                                <option value="">{{msg('indicators.list.allCategories')}}</option>
                            </select>
                        </div>
                        <table class="table table-hover" ng-show="indicators.length > 0">
                            <thead>
                            <tr>
                                <th>{{msg('indicators.list.displayName')}}</th>
                                <th>{{msg('common.actions')}}</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="item in indicators | orderBy:'+name'">
                                <td><a href="#/indicators/{{item.id}}">{{item.name}}</a></td>
                                <td><span class="btn btn-link" ng-click="deleteIndicator(item);"><i class="icon-remove"></i></span></td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="row-fluid">
                            <br ng-show="indicators.length == 0"/>
                            <h4><p class="text-info text-center " ng-show="indicators.length == 0">{{msg('indicators.list.empty')}}<br/><br/></p></h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
